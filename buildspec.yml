version: 0.2
# Defining default values for all jobs
defaults: &defaults
env:
  variables:
    SFDX_USE_GENERIC_UNIX_KEYCHAIN: "true"

phases:
  pre_build:
    commands:
      - echo Nothing to do in the pre_build phase...
      - npm install sfdx-cli --global
      #- npm update --global sfdx-cli
      - curl -fL https://getcli.jfrog.io | sh
  build:
    commands:
      - echo Build started on `14/05/2020`
      - echo $salesforceInstanceURL
      - echo $salesforceUserName
      - echo $salesforceClientId
      #- sfdx --help
      - sfdx force:auth:jwt:grant --clientid $salesforceClientId --jwtkeyfile ./server.key --username $salesforceUserName --instanceurl $salesforceInstanceURL -a SIT
      - sfdx force:mdapi:deploy -l RunLocalTests -c -d ./force-app/main/default/ -u SIT -w 10
      
